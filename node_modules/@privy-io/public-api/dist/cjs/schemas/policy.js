"use strict";var e=require("zod"),r=require("@privy-io/api-base"),t=require("./wallet-api/wallets.js");require("./api.js"),require("./core.js"),require("bs58"),require("libphonenumber-js/max"),require("viem"),require("./transaction.js"),require("./wallet-api/export.js");const i=e.z.enum(["ALLOW","DENY"]);let o=e.z.union([e.z.string(),e.z.number(),e.z.boolean(),e.z.null()]),n=e.z.lazy((()=>e.z.union([o,e.z.array(n),e.z.record(n)])));const a=e.z.union([e.z.literal("eq"),e.z.literal("gt"),e.z.literal("gte"),e.z.literal("lt"),e.z.literal("lte"),e.z.literal("in")]),s=e.z.object({operator:a,value:e.z.union([e.z.string(),e.z.array(e.z.string())])}),l=e.z.object({field_source:e.z.literal("ethereum_transaction"),field:e.z.union([e.z.literal("to"),e.z.literal("value")])}).strict().merge(s),c=e.z.object({field_source:e.z.literal("ethereum_calldata"),field:e.z.string(),abi:n}).strict().merge(s),d=e.z.object({field_source:e.z.literal("ethereum_typed_data_domain"),field:e.z.union([e.z.literal("chainId"),e.z.literal("verifyingContract"),e.z.literal("chain_id"),e.z.literal("verifying_contract")])}).strict().merge(s),u=e.z.object({field_source:e.z.literal("ethereum_typed_data_message"),field:e.z.string(),typed_data:e.z.object({types:t.TypedDataTypesInputParams,primary_type:e.z.string()})}).strict().merge(s),m=e.z.object({field_source:e.z.literal("ethereum_7702_authorization"),field:e.z.literal("contract")}).strict().merge(s),z=e.z.object({field_source:e.z.literal("solana_program_instruction"),field:e.z.literal("programId")}).strict().merge(s),p=e.z.object({field_source:e.z.literal("solana_system_program_instruction"),field:e.z.union([e.z.literal("instructionName"),e.z.literal("Transfer.from"),e.z.literal("Transfer.to"),e.z.literal("Transfer.lamports")])}).strict().merge(s),_=e.z.object({field_source:e.z.literal("solana_token_program_instruction"),field:e.z.union([e.z.literal("instructionName"),e.z.literal("TransferChecked.source"),e.z.literal("TransferChecked.destination"),e.z.literal("TransferChecked.authority"),e.z.literal("TransferChecked.amount"),e.z.literal("TransferChecked.mint")])}).strict().merge(s),h=e.z.discriminatedUnion("field_source",[l,c,d,u,m,z,p,_]),y=e.z.object({name:e.z.string().max(50,"Rule name must be fewer than 50 characters"),conditions:e.z.array(h),action:i}).strict();let g=e.z.union([e.z.literal("eth_sendTransaction"),e.z.literal("eth_signTransaction"),e.z.literal("eth_signTypedData_v4"),e.z.literal("eth_sign7702Authorization"),e.z.literal("signTransaction"),e.z.literal("signAndSendTransaction"),e.z.literal("exportPrivateKey"),e.z.literal("*")]),f=e.z.object({method:g,rules:e.z.array(y)}).strict().transform((e=>{let r=[];for(let t of e.rules){let i=b.parse({name:t.name,method:e.method,conditions:t.conditions,action:t.action});r.push(i)}return r}));const b=e.z.object({name:e.z.string().max(50,"Rule name must be fewer than 50 characters"),method:g,conditions:e.z.array(h),action:i}).strict(),w=b.extend({id:e.z.string()}).strict(),v=b.extend({id:e.z.string().optional()}).strict();const x=e.z.object({policy_id:e.z.string().min(1),rule_id:e.z.string().min(1)}).catch((({error:e})=>{throw new r.InvalidInputError(e.message,r.PrivyErrorCode.INVALID_DATA)}));let I=e.z.object({version:e.z.literal("1.0"),name:e.z.string().max(50,"Policy name must be fewer than 50 characters"),chain_type:t.ChainType,method_rules:e.z.array(f),default_action:i,...t.OwnerInputFields}).strict(),j=e.z.object({version:e.z.literal("1.0"),name:e.z.string().max(50,"Policy name must be fewer than 50 characters"),chain_type:t.ChainType,rules:e.z.array(v),...t.OwnerInputFields}).strict();const T=e.z.union([I,j]).transform((e=>{if(!("method_rules"in e))return e;{let r={version:e.version,name:e.name,chain_type:e.chain_type,rules:e.method_rules.flat(),owner:e.owner,owner_id:e.owner_id};return"ALLOW"===e.default_action&&r.rules.push(v.parse({name:"Default Action",method:"*",conditions:[],action:i.enum.ALLOW})),j.parse(r)}})).refine((e=>!e.owner||!e.owner_id),{message:"Only one of owner or owner_id can be provided."}),P=j.omit({owner:!0,owner_id:!0}).extend({id:e.z.string(),created_at:e.z.number(),owner_id:t.KeyQuorumId.nullable(),rules:e.z.array(w)}),C=e.z.object({policy_id:e.z.string({required_error:"Policy ID must be provided",invalid_type_error:"Policy ID is not a valid string"}).min(1)}).catch((({error:e})=>{throw new r.InvalidInputError(e.message,r.PrivyErrorCode.INVALID_DATA)}));let A=e.z.object({name:e.z.string().trim().min(1,"Name is required").max(50,"Policy name must be fewer than 50 characters").optional(),method_rules:e.z.array(f).optional(),...t.OwnerInputFields}).strict().superRefine(((e,r)=>{Object.values(e).every((e=>void 0===e||""===e))&&r.addIssue({code:"custom",message:"At least one field must be provided"}),void 0!==e.owner&&void 0!==e.owner_id&&r.addIssue({code:"custom",message:"Only one of owner or owner_id can be provided."})})),q=e.z.object({name:e.z.string().trim().min(1,"Name is required").max(50,"Policy name must be fewer than 50 characters").optional(),rules:e.z.array(b).optional(),...t.OwnerInputFields}).strict().superRefine(((e,r)=>{Object.values(e).every((e=>void 0===e||""===e))&&r.addIssue({code:"custom",message:"At least one field must be provided"}),void 0!==e.owner&&void 0!==e.owner_id&&r.addIssue({code:"custom",message:"Only one of owner or owner_id can be provided."})}));const D=e.z.union([A,q]).transform((e=>"method_rules"in e?q.parse({name:e.name,rules:e.method_rules?.flat()??[],owner:e.owner,owner_id:e.owner_id}):q.parse(e)));exports.BaseCondition=s,exports.Condition=h,exports.ConditionOperator=a,exports.Ethereum7702AuthorizationCondition=m,exports.EthereumCalldataCondition=c,exports.EthereumTransactionCondition=l,exports.EthereumTypedDataDomainCondition=d,exports.EthereumTypedDataMessageCondition=u,exports.LegacyRule=y,exports.PolicyAction=i,exports.PolicyIdFromPath=C,exports.PolicyResponse=P,exports.PolicyWithoutValidation=T,exports.Rule=v,exports.RuleIdAndPolicyIdFromPath=x,exports.RuleInput=b,exports.RuleResponse=w,exports.SolanaProgramInstruction=z,exports.SolanaSystemProgramInstruction=p,exports.SolanaTokenProgramInstruction=_,exports.UpdatePolicyInput=D,exports.generateRuleIdFromName=function(e){return e.toLowerCase().replace(/ /g,"-")+"-"+crypto.randomUUID().slice(0,8)};
